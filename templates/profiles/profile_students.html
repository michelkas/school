{% extends "base.html" %}

{% block content %}
  <header id="header" class="header d-flex align-items-center fixed-top">
    <div class="container-fluid container-xl position-relative d-flex align-items-center justify-content-between">

      <a href="{% url "general:index" %}" class="logo d-flex align-items-center">
        <!-- Uncomment the line below if you also wish to use an image logo -->
        <!-- <img src="assets/img/logo.webp" alt=""> -->
        <i class="bi bi-arrow-left text-warning fs-5"></i>
     
      </a>
      {% if user.is_authenticated  %}
      {% if user.is_authenticated and user.id == profile.id %}
            <nav id="navmenu" class="navmenu">
              <ul>
                    <li><a href="{% url "accounts:logout" %}" class="text-danger">Deconnexion</a></li>
                    {% if is_staff %}  <li><a href="{% url "admin:index" %}">Configuration</a></li>{% endif %}
              </ul>
              <i class="mobile-nav-toggle d-xl-none bi bi-list auto"></i>
            </nav>
      {% endif %}
      {% endif %}
    </div>
  </header>

  <div class="container-fluid p-0 position-relative">
   <div class="page-title dark-background" style="max-height:20px; background: skyblue;" ></div>
   {% if profile %}
    <img src="{{profile.avatar.url}} " alt="Avatar" class="rounded-circle border border-white position-absolute" style="width:120px; bottom:-60px; left:20px;">
   {% endif %}
  </div>

  <!-- Info utilisateur -->
  <section class="container  ms-auto mt-auto">
    <div class="d-flex justify-content-between align-items-start "  >
      <div>
        {% if students %}
          <h2 class="mb-1">{{ students.name|capfirst }} {{ students.surname|capfirst }} {{ students.first_name|capfirst }}</h2>
          <h6 class="text-muted ">  <span class="bi bi-mortarboard-fill"></span> {{students.classe |capfirst }}  {% if students.option %} {{students.option}} {% else %}  {{students.section}} {% endif %}</h6>
          <h6 class="text-muted ">  <span class="bi bi-person-badge-fill"></span> {{students.matricule}} </h6>
          <h6 class="text-muted ">  <span class="bi bi-person-fill"></span> {{students.sexe}} </h6>
          <h6 class="text-muted ">  <span class="bi bi-geo-alt-fill"></span> {{students.address}} </h6>
            <h6 class="text-muted ">  <span class="bi bi-calendar-fill"></span> {{age}} ans,  {% if students.sexe == "masculin" %} Né{% else %}Née{% endif %} le {{students.date_birthday}} </h6>
          {% else %}
              {% if user.first_name and user.last_name  %}
                 <h2 class="mb-1"> {{ user.first_name|capfirst }} {{ user.last_name|capfirst }}</h2>
                 {% else %}
                  <h2 class="mb-1"> {{ user.username|capfirst }} </h2>
               {% endif %}

          {% endif %}

      </div>
    
     
    </div>
    {% if profile %}
    <p class="mt-2" > {% if profile.bio %}{{profile.bio}}{% endif %}</p>
    {% endif %}

    <!-- Statistiques -->
    

    <!-- Onglets -->
  

 
        <div class="row">
          <div class="col-lg-5" data-aos="fade-up" data-aos-delay="300">
            <div class="departments-nav">
              
                <ul class="nav nav-tabs">
                <li class="nav-item" ><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#faculty--staff-tab-1">Information supplementaire</button></li>
                </ul>
            </div>
          </div>

          <div class="cards" data-aos="fade-up" data-aos-delay="400">
            <div class="tab-content">

                <div class="tab-pane fade  show active " id="faculty--staff-tab-1">
      
                  <div class="row g-4">

                      <div class="col-md-6 col-lg-4">
                        <p><h4 class="mb-2 text-muted">___Tuteur___  </h4></p>
                        <div class="faculty-card ">
                              <div class="faculty-info ">
                                <div class="faculty-specialties" style=" " >
                                  <h6 class=" bi bi-person" > {{students.garduan}} </h6>
                                  <h6 class=" bi bi-phone"> {{students.contact_garduan}} </h6>
                                  <h6 class=" bi bi-geo-alt-fill"> {{students.address_garduan}} </h6>
                                </div>
                              </div>
                        </div>
                      </div>

                      <div class="col-md-6 col-lg-4">
                        <p> <h4 class="mb-2 text-muted">___Parents___  </h4></p>
                        <div class="faculty-card ">
                              <div class="faculty-info ">
                                <div class="faculty-specialties" style=" " >
                                  <h6 class=" bi bi-gender-male" > {{students.father_name}} </h6>
                                  <h6 class=" bi bi-gender-female"> {{students.mother_name}} </h6>
                                </div>
                              </div>
                        </div>
                      </div>

                  </div>
                </div>

            </div>
          </div>
       
  </section>

  <section class="container py-4">
      <div class="row justify-content-center">
        {% if groupe_frais.items %}
        <p> <h4 class="mb-2 text-muted" >Paiements  </h4></p>
          {% for frais, mois_dict in groupe_frais.items %}
              {% for mois, infos in mois_dict.items %}
                  {% for info in infos %}
                      <div class="col-md-8 col-lg-6 mb-4">
                          <div class="card shadow-sm border-0">
                              <div class="card-header bg-info text-white">
                                  <h5 class="mb-0"  >{{ frais|capfirst}}</h5>
                              </div>
                              <div class="card-body bg-light">
                                  <div class="mb-2"><span class="fw-bold text-secondary">Montant Frais :</span> <span class="badge bg-success">{{ info.fees_mount|floatformat:0 }} FC</span></div>
                                  <div class="mb-2"><span class="fw-bold text-secondary">Mois :</span> <span class="badge bg-primary text-white">{% if info.months == 1 %}Septembre{% elif info.months == 2 %}Octobre{% elif info.months == 3 %}Novembre{% elif info.months == 4 %}Décembre{% elif info.months == 5 %}Janvier{% elif info.months == 6 %}Février{% elif info.months == 7 %}Mars{% elif info.months == 8 %}Avril{% elif info.months == 9 %}Mai{% elif info.months == 10 %}Juin{% else %}{{ info.months }}{% endif %}</span></div>
                                  <div class="mb-2"><span class="fw-bold text-secondary">Détails paiement :</span></div>
                                  <ul class="list-group list-group-flush mb-2">
                                      {% for paiement in info.details_paiement %}
                                          <li class="list-group-item">
                                              -le <span class="text-primary">{{ paiement.date }}</span> paye <span class="fw-bold">{{ paiement.montant|floatformat:0 }} FC</span>
                                             
                                          </li>
                                      {% endfor %}
                                
                                  <div class="mb-2"><span class="fw-bold text-secondary">Statut :</span></div>
                                  <ul class="list-group list-group-flush">
                                      <li class="list-group-item">Dette : <span class="fw-bold text-danger">{{ info.dette|floatformat:0 }}</span></li>
                                      <li class="list-group-item">Total payé : <span class="fw-bold text-success">{{ info.total|floatformat:0 }}</span></li>
                                  </ul>
                              </div>
                          </div>
                      </div>
                  {% endfor %}
              {% endfor %}
          {% endfor %}
        {% else %}
         <div><i colspan="10" class="text-center">Aucun paiement trouvée.</i></div>
        {% endif %}
      </div>
  </section>

  {% include "includes/foot.html" %}
{% endblock  %}


